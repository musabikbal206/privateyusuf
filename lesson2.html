<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fun Personality Quiz | Musab ƒ∞kbal SUBA≈ûI</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:wght@400;600;700&display=swap');

        :root {
            --navy: #0A192F;
            --navy-light: #112240;
            --gold: #D4AF37;
            --cream: #F8F8F0;
            --white: #ffffff;
            --success: #2ecc71;
            --error: #e74c3c;
            --shadow: 0 10px 30px -10px rgba(0,0,0,0.5);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background-color: var(--navy);
            color: var(--cream);
            font-family: 'Lato', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* HEADER */
        header {
            background: linear-gradient(180deg, var(--navy-light) 0%, var(--navy) 100%);
            padding: 2rem;
            text-align: center;
            border-bottom: 3px solid var(--gold);
            box-shadow: var(--shadow);
        }

        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            color: var(--gold);
            margin-bottom: 0.5rem;
            letter-spacing: 1px;
        }

        .subtitle {
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 3px;
            opacity: 0.8;
        }

        /* CONTAINER */
        .container {
            max-width: 1000px;
            margin: 2rem auto;
            width: 95%;
            flex: 1;
        }

        /* NAVIGATION */
        .tabs {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 2rem;
        }

        .tab-btn {
            background: transparent;
            border: 1px solid var(--gold);
            color: var(--gold);
            padding: 10px 20px;
            font-family: 'Playfair Display', serif;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 4px;
            flex: 1 1 auto;
            text-align: center;
            min-width: 120px;
        }

        .tab-btn:hover, .tab-btn.active {
            background: var(--gold);
            color: var(--navy);
            transform: translateY(-2px);
            font-weight: bold;
        }

        /* SECTIONS */
        .section {
            display: none;
            animation: fadeIn 0.5s ease;
            background: var(--navy-light);
            padding: 2rem;
            border-radius: 12px;
            border: 1px solid rgba(212, 175, 55, 0.2);
            margin-bottom: 2rem;
        }

        .section.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 {
            font-family: 'Playfair Display', serif;
            color: var(--gold);
            border-bottom: 1px solid rgba(212, 175, 55, 0.3);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        /* ACTIVITY 1: STORY */
        .story-text {
            line-height: 1.8;
            font-size: 1.1rem;
        }

        .story-sentence {
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .story-sentence:hover {
            background: rgba(212, 175, 55, 0.2);
        }

        .story-sentence.playing {
            background: var(--gold);
            color: var(--navy);
        }

        /* ACTIVITY 2: FLASHCARDS */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .card {
            background: var(--cream);
            color: var(--navy);
            height: 220px;
            perspective: 1000px;
            cursor: pointer;
            border-radius: 8px;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid var(--gold);
        }

        .card-back {
            transform: rotateY(180deg);
            background: var(--navy);
            color: var(--gold);
        }

        .card-icon { font-size: 3rem; margin-bottom: 10px; }
        .card-word { font-family: 'Playfair Display', serif; font-size: 1.4rem; font-weight: bold; }
        .card-def { font-size: 0.9rem; line-height: 1.4; }

        /* ACTIVITY 3: TRUE OR FALSE */
        .tf-container { display: flex; flex-direction: column; gap: 15px; }
        .tf-item {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 3px solid var(--gold);
        }
        .tf-btn {
            padding: 8px 16px;
            border: 1px solid var(--gold);
            background: transparent;
            color: var(--gold);
            cursor: pointer;
            margin-left: 5px;
            border-radius: 4px;
            transition: 0.2s;
        }
        .tf-btn:hover { background: rgba(212, 175, 55, 0.2); }
        .tf-btn.correct { background: var(--success); color: white; border-color: var(--success); }
        .tf-btn.wrong { background: var(--error); color: white; border-color: var(--error); }

        /* ACTIVITY 4: SENTENCE BUILDER */
        .scramble-box {
            background: rgba(0,0,0,0.2);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }
        .word-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
            min-height: 50px;
        }
        .drop-zone {
            border-bottom: 2px solid var(--gold);
            min-height: 50px;
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            padding: 10px;
            margin-bottom: 15px;
            background: rgba(255,255,255,0.05);
        }
        .scramble-word {
            background: var(--cream);
            color: var(--navy);
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            user-select: none;
            border: 1px solid var(--gold);
        }

        /* ACTIVITY 5: MATCH UP */
        .match-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .match-col { display: flex; flex-direction: column; gap: 10px; }
        .match-card {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border: 1px solid var(--gold);
            cursor: pointer;
            text-align: center;
            transition: 0.2s;
            border-radius: 6px;
        }
        .match-card:hover { background: var(--gold); color: var(--navy); }
        .match-card.selected { background: var(--gold); color: var(--navy); transform: scale(1.02); }
        .match-card.matched { background: var(--success); color: white; border-color: var(--success); opacity: 0.5; pointer-events: none; }

        /* ACTIVITY 6: SORTING */
        .sorting-area {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        .sort-bucket {
            flex: 1;
            border: 2px dashed var(--gold);
            padding: 20px;
            border-radius: 8px;
            min-height: 200px;
            text-align: center;
            transition: background 0.3s;
        }
        .sort-bucket.drag-over { background: rgba(212, 175, 55, 0.1); }
        .bucket-title { font-family: 'Playfair Display', serif; color: var(--gold); margin-bottom: 10px; font-size: 1.2rem; }
        .draggable-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }
        .draggable {
            background: var(--cream);
            color: var(--navy);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: grab;
            font-weight: bold;
            border: 1px solid var(--gold);
        }

        /* ACTIVITY 7: CHAT SIM */
        .chat-screen {
            background: #fff;
            color: #333;
            border-radius: 12px;
            max-width: 500px;
            margin: 0 auto;
            height: 450px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 4px solid var(--navy-light);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .chat-header {
            background: var(--gold);
            color: var(--navy);
            padding: 15px;
            text-align: center;
            font-weight: bold;
            font-family: 'Playfair Display', serif;
            font-size: 1.2rem;
        }
        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: #f0f0f0;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .msg {
            padding: 10px 15px;
            border-radius: 12px;
            max-width: 80%;
            font-size: 0.95rem;
            line-height: 1.4;
        }
        .msg.received { background: white; align-self: flex-start; border-top-left-radius: 0; border: 1px solid #ddd; }
        .msg.sent { background: var(--navy); color: var(--gold); align-self: flex-end; border-top-right-radius: 0; }
        .chat-options {
            padding: 15px;
            background: #e0e0e0;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .chat-btn {
            background: white;
            border: 1px solid var(--navy);
            color: var(--navy);
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            text-align: left;
            transition: 0.2s;
            font-weight: bold;
        }
        .chat-btn:hover { background: var(--navy); color: var(--gold); }

        /* ACTIVITY 8: DICTATION */
        .dictation-box { text-align: center; max-width: 500px; margin: 0 auto; }
        .dictation-input {
            width: 100%;
            padding: 15px;
            margin: 20px 0;
            border: 2px solid var(--gold);
            background: rgba(255,255,255,0.1);
            color: var(--cream);
            font-size: 1.2rem;
            border-radius: 8px;
            text-align: center;
        }

        .btn-main {
            background: var(--gold);
            color: var(--navy);
            border: none;
            padding: 10px 30px;
            font-size: 1rem;
            cursor: pointer;
            font-weight: bold;
            border-radius: 4px;
            transition: 0.3s;
        }
        .btn-main:hover { background: var(--white); }

        .feedback-msg { margin-top: 15px; font-weight: bold; min-height: 24px; text-align: center; }

        /* FOOTER */
        footer {
            text-align: center;
            padding: 2rem;
            border-top: 1px solid rgba(212, 175, 55, 0.3);
            margin-top: auto;
            color: var(--gold);
        }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
            .tabs { flex-direction: column; }
            .match-container { grid-template-columns: 1fr; }
            .sorting-area { flex-direction: column; }
            .card { height: 250px; }
            .chat-screen { width: 100%; }
        }
    </style>
</head>
<body>

    <header>
        <div style="font-size: 2rem;">üëë</div>
        <h1>Fun Personality Quiz</h1>
        <div class="subtitle">Private Lesson ‚Ä¢ Beginner A1-A2</div>
    </header>

    <div class="container">
        <!-- Navigation -->
        <nav class="tabs">
            <button class="tab-btn active" onclick="openTab('story')">1. Story</button>
            <button class="tab-btn" onclick="openTab('vocab')">2. Words</button>
            <button class="tab-btn" onclick="openTab('tf')">3. True/False</button>
            <button class="tab-btn" onclick="openTab('sentence')">4. Builder</button>
            <button class="tab-btn" onclick="openTab('match')">5. Quiz Match</button>
            <button class="tab-btn" onclick="openTab('sorting')">6. Sort</button>
            <button class="tab-btn" onclick="openTab('chat')">7. Chat</button>
            <button class="tab-btn" onclick="openTab('dictation')">8. Listen</button>
        </nav>

        <!-- 1. Interactive Story -->
        <div id="story" class="section active">
            <h2>üìñ Yusuf and the Personality Quiz</h2>
            <p style="margin-bottom: 15px; font-style: italic; color: #aaa;">Click any sentence to listen.</p>
            <div id="story-content" class="story-text"></div>
        </div>

        <!-- 2. Vocabulary -->
        <div id="vocab" class="section">
            <h2>üìá Vocabulary Flashcards</h2>
            <div class="grid" id="vocab-grid"></div>
        </div>

        <!-- 3. True or False -->
        <div id="tf" class="section">
            <h2>‚ùì True or False?</h2>
            <p>Read the sentences about Yusuf's story. Is it True or False?</p>
            <div class="tf-container" id="tf-container">
                <!-- JS populates this -->
            </div>
            <p id="tf-feedback" class="feedback-msg"></p>
        </div>

        <!-- 4. Sentence Builder -->
        <div id="sentence" class="section">
            <h2>üèóÔ∏è Sentence Builder</h2>
            <p>Click the words in the correct order to form the rule from the quiz.</p>
            <div class="scramble-box">
                <h3 id="scramble-hint" style="color:var(--gold); margin-bottom:10px;">Hint</h3>
                <div class="drop-zone" id="scramble-zone"></div>
                <div class="word-bank" id="scramble-bank"></div>
                <button class="btn-main" onclick="resetScramble()" style="margin-top:15px; font-size:0.8rem;">Reset</button>
            </div>
            <p id="scramble-feedback" class="feedback-msg"></p>
            <button class="btn-main" onclick="nextScramble()">Next Sentence ‚û°</button>
        </div>

        <!-- 5. Match Up -->
        <div id="match" class="section">
            <h2>üîó Quiz Result Match</h2>
            <p>Match the Image (Left) to the Personality Trait (Right).</p>
            <div class="match-container">
                <div class="match-col" id="match-left"></div>
                <div class="match-col" id="match-right"></div>
            </div>
            <p id="match-feedback" class="feedback-msg"></p>
        </div>

        <!-- 6. Sorting Game -->
        <div id="sorting" class="section">
            <h2>üßê What did Yusuf see?</h2>
            <p>Drag the items to the correct bucket based on the story.</p>
            <div class="draggable-container" id="draggable-source">
                <div class="draggable" draggable="true" ondragstart="drag(event)" id="d1">Boat</div>
                <div class="draggable" draggable="true" ondragstart="drag(event)" id="d2">Crocodile</div>
                <div class="draggable" draggable="true" ondragstart="drag(event)" id="d3">Car</div>
                <div class="draggable" draggable="true" ondragstart="drag(event)" id="d4">Binoculars</div>
                <div class="draggable" draggable="true" ondragstart="drag(event)" id="d5">Faces</div>
                <div class="draggable" draggable="true" ondragstart="drag(event)" id="d6">Candlesticks</div>
                <div class="draggable" draggable="true" ondragstart="drag(event)" id="d7">Social</div>
                <div class="draggable" draggable="true" ondragstart="drag(event)" id="d8">Careful</div>
            </div>
            <div class="sorting-area">
                <div class="sort-bucket" ondrop="drop(event, 'saw')" ondragover="allowDrop(event)">
                    <div class="bucket-title">‚úÖ What Yusuf Saw (Is)</div>
                </div>
                <div class="sort-bucket" ondrop="drop(event, 'didnt')" ondragover="allowDrop(event)">
                    <div class="bucket-title">‚ùå What He Didn't See (Isn't)</div>
                </div>
            </div>
            <p id="sort-feedback" class="feedback-msg"></p>
        </div>

        <!-- 7. Chat Simulator -->
        <div id="chat" class="section">
            <h2>üí¨ Chat Simulator</h2>
            <p style="margin-bottom:10px;">Yusuf is telling his friend Ali about the quiz. Choose the right answers!</p>
            <div class="chat-screen">
                <div class="chat-header">Chat with Ali</div>
                <div class="chat-messages" id="chat-messages">
                    <div class="msg received">Ali: Hey Yusuf! How was Professor Selim's class today?</div>
                </div>
                <div class="chat-options" id="chat-options">
                    <button class="chat-btn" onclick="handleChat(0)">It was boring. We studied circuits.</button>
                    <button class="chat-btn" onclick="handleChat(1)">It was fun! We took a personality quiz.</button>
                </div>
            </div>
        </div>

        <!-- 8. Dictation -->
        <div id="dictation" class="section">
            <h2>üéß Listening Dictation</h2>
            <div class="dictation-box">
                <button class="btn-main" onclick="playDictationWord()">üîä Play Word</button>
                <input type="text" id="dictation-input" class="dictation-input" placeholder="Type what you hear...">
                <button class="btn-main" onclick="checkDictation()">Check Spelling</button>
                <div id="dictation-feedback" class="feedback-msg"></div>
            </div>
        </div>

    </div>

    <footer>
        Private Lesson for Musab ƒ∞kbal SUBA≈ûI ‚Ä¢ Created with Excellence üëë
    </footer>

    <script>
        /* --- 1. STORY DATA --- */
        const storyText = `Today, Yusuf is nervous. He has a big exam tomorrow. He looks at his heavy books and sighs. He wants to do well, but he feels a little bit stressed. Yusuf goes to his morning class. Professor Selim is at the front of the room. "Hello, Yusuf!" says Professor Selim. "Don't be nervous. Today, we are not studying circuits. We have a fun personality quiz! It is an icebreaker to help us relax."
        Professor Selim shows the first picture on the screen. "Look at this image," he says. "What did you see first? A crocodile or a boat?" Yusuf looks very closely at the screen. He sees a boat on the water immediately. He does not see the animal yet.
        Professor Selim explains the first result. "If you saw the crocodile, you are a very careful person," he says. "You do not like to take risks." Yusuf thinks about his engineering projects. He is always very careful with wires and electricity.
        "If you saw the boat, you are a creative person," Selim continues. "You pay attention to small details when you do your homework." Yusuf nods his head. He likes finding creative ways to solve math problems. He feels more relaxed now.
        Now, they look at a second image. It is a drawing of a landscape. "What do you see now?" Selim asks. Yusuf looks at the colors. He sees a car driving on a road. He does not see the man with binoculars.
        "If you saw the car, you like to be free," says Selim. "It means you love traveling and spending time with others." Yusuf thinks about the summer holidays. He is very excited about traveling to the sea with his family after his exams.
        Professor Selim points to a small part of the picture. "Look at the letter A," he says. "It is very hard to see. If you saw the letter A first, you have an eagle eye. You can see things that other people cannot see."
        The last picture is very tricky. "Do you see faces or candlesticks?" Selim asks. Yusuf sees two faces looking at each other. "If you saw the faces, you are a social person," says the professor. Yusuf agrees. He loves talking to his classmates.
        The class is over. Yusuf is not nervous anymore. He is happy and full of energy. He learned that he is a creative and social person. "Thank you, Professor Selim!" Yusuf says. He picks up his books and goes to the cafeteria to study with his friends.`;

        /* --- 2. VOCAB DATA --- */
        const vocabList = [
            { word: "Crocodile", icon: "üêä", def: "A big reptile with sharp teeth." },
            { word: "Boat", icon: "üö§", def: "Something used to travel on water." },
            { word: "Binoculars", icon: "üî≠", def: "A tool to see things far away." },
            { word: "Visual learner", icon: "üëÅÔ∏è", def: "Someone who learns by seeing." },
            { word: "Social", icon: "üó£Ô∏è", def: "Someone who likes being with people." },
            { word: "Eagle eye", icon: "ü¶Ö", def: "Ability to see very small details." },
            { word: "Candlesticks", icon: "üïØÔ∏è", def: "Holders for candles." },
            { word: "Logical", icon: "üß†", def: "Using reason and thinking clearly." },
            { word: "Emotional", icon: "‚ù§Ô∏è", def: "Following your feelings/heart." },
            { word: "Analytical", icon: "üìä", def: "Thinking about details carefully." }
        ];

        /* --- 3. TRUE/FALSE DATA --- */
        const tfQuestions = [
            { q: "Yusuf has a big exam tomorrow.", a: true },
            { q: "Professor Selim taught about circuits today.", a: false },
            { q: "Yusuf saw the crocodile first.", a: false },
            { q: "Seeing the car means you like to be free.", a: true },
            { q: "Yusuf is an introverted person.", a: false }
        ];

        /* --- 4. SENTENCE BUILDER DATA --- */
        const sentences = [
            { text: "If you saw the boat you are creative", hint: "Result of seeing the boat" },
            { text: "You pay attention to small details", hint: "What creative people do" },
            { text: "He sees a car driving on a road", hint: "What Yusuf saw in the landscape" },
            { text: "Do you see faces or candlesticks", hint: "The last question" }
        ];
        let currentSentenceIdx = 0;
        let builtSentence = [];

        /* --- 5. MATCHING DATA --- */
        const matchPairs = [
            { q: "Crocodile üêä", a: "Careful Person" },
            { q: "Boat üö§", a: "Creative Person" },
            { q: "Faces üôÇ", a: "Social Person" },
            { q: "Candlesticks üïØÔ∏è", a: "Introverted/Alone" },
            { q: "Letter A üÖ∞Ô∏è", a: "Eagle Eye" }
        ];
        let selectedLeft = null;

        /* --- 6. SORTING DATA --- */
        const sortData = {
            'd1': 'saw',   // Boat
            'd2': 'didnt', // Crocodile
            'd3': 'saw',   // Car
            'd4': 'didnt', // Binoculars
            'd5': 'saw',   // Faces
            'd6': 'didnt', // Candlesticks
            'd7': 'saw',   // Social
            'd8': 'didnt'  // Careful
        };

        /* --- 7. CHAT DATA --- */
        const chatSteps = [
            {
                msg: "Ali: Oh cool! What was the first picture?",
                opts: [
                    { txt: "It was a crocodile vs a boat.", correct: true },
                    { txt: "It was a duck vs a rabbit.", correct: false }
                ]
            },
            {
                msg: "Ali: Interesting. Which one did you see?",
                opts: [
                    { txt: "I saw the crocodile. I am scary.", correct: false },
                    { txt: "I saw the boat. It means I am creative.", correct: true }
                ]
            },
            {
                msg: "Ali: Nice! Being creative helps with engineering too. Did you see the faces?",
                opts: [
                    { txt: "Yes! It means I am social.", correct: true },
                    { txt: "No, I saw the candlesticks.", correct: false }
                ]
            }
        ];
        let chatStepIdx = 0;

        /* --- INITIALIZATION --- */
        window.onload = function() {
            initStory();
            initVocab();
            initTF();
            loadScramble(0);
            initMatch();
        };

        function speak(text) {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 0.9;
            window.speechSynthesis.speak(utterance);
        }

        /* --- TAB LOGIC --- */
        function openTab(tabName) {
            document.querySelectorAll('.section').forEach(x => x.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(x => x.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        /* --- 1. STORY LOGIC --- */
        function initStory() {
            const container = document.getElementById('story-content');
            const sentencesArr = storyText.match( /[^\.!\?]+[\.!\?]+/g );
            sentencesArr.forEach(sentence => {
                const span = document.createElement('span');
                span.className = 'story-sentence';
                span.textContent = sentence.trim() + " ";
                span.onclick = function() {
                    document.querySelectorAll('.story-sentence').forEach(s => s.classList.remove('playing'));
                    this.classList.add('playing');
                    speak(sentence);
                };
                container.appendChild(span);
            });
        }

        /* --- 2. VOCAB LOGIC --- */
        function initVocab() {
            const grid = document.getElementById('vocab-grid');
            vocabList.forEach(item => {
                const card = document.createElement('div');
                card.className = 'card';
                card.onclick = function() { this.classList.toggle('flipped'); };
                card.innerHTML = `
                    <div class="card-inner">
                        <div class="card-front">
                            <div class="card-icon">${item.icon}</div>
                            <div class="card-word">${item.word}</div>
                            <small style="margin-top:10px; opacity:0.7;">Click to flip</small>
                        </div>
                        <div class="card-back">
                            <div class="card-def">${item.def}</div>
                            <button onclick="event.stopPropagation(); speak('${item.word}')" style="margin-top:15px; padding:5px 10px; background:var(--gold); border:none; border-radius:4px; cursor:pointer;">üîä Listen</button>
                        </div>
                    </div>`;
                grid.appendChild(card);
            });
        }

        /* --- 3. TRUE/FALSE LOGIC --- */
        function initTF() {
            const container = document.getElementById('tf-container');
            tfQuestions.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'tf-item';
                div.innerHTML = `
                    <span>${index + 1}. ${item.q}</span>
                    <div>
                        <button class="tf-btn" onclick="checkTF(this, ${item.a}, true)">True</button>
                        <button class="tf-btn" onclick="checkTF(this, ${item.a}, false)">False</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function checkTF(btn, correctAnswer, userAnswer) {
            const parent = btn.parentElement;
            parent.querySelectorAll('.tf-btn').forEach(b => {
                b.classList.remove('correct', 'wrong');
                b.disabled = true;
            });
            
            const feedback = document.getElementById('tf-feedback');
            if (userAnswer === correctAnswer) {
                btn.classList.add('correct');
                feedback.textContent = "Correct! Well done.";
                feedback.style.color = "#2ecc71";
            } else {
                btn.classList.add('wrong');
                feedback.textContent = "Oops! That's not right.";
                feedback.style.color = "#e74c3c";
            }
        }

        /* --- 4. SENTENCE BUILDER LOGIC --- */
        function loadScramble(idx) {
            currentSentenceIdx = idx;
            builtSentence = [];
            const data = sentences[idx];
            document.getElementById('scramble-hint').textContent = "Hint: " + data.hint;
            const zone = document.getElementById('scramble-zone');
            const bank = document.getElementById('scramble-bank');
            zone.innerHTML = '';
            bank.innerHTML = '';
            document.getElementById('scramble-feedback').textContent = '';

            const words = data.text.split(' ').sort(() => Math.random() - 0.5);
            words.forEach(word => {
                const el = document.createElement('div');
                el.className = 'scramble-word';
                el.textContent = word;
                el.onclick = function() {
                    if (el.parentElement === bank) {
                        zone.appendChild(el);
                        builtSentence.push(word);
                    } else {
                        bank.appendChild(el);
                        builtSentence = builtSentence.filter(w => w !== word);
                    }
                    checkScramble();
                };
                bank.appendChild(el);
            });
        }

        function checkScramble() {
            const currentTarget = sentences[currentSentenceIdx].text.split(' ').join('');
            const currentBuilt = Array.from(document.getElementById('scramble-zone').children).map(c => c.textContent).join('');
            const feedback = document.getElementById('scramble-feedback');
            
            if (currentBuilt === currentTarget) {
                feedback.textContent = "‚úÖ Correct Sentence!";
                feedback.style.color = "#2ecc71";
                speak(sentences[currentSentenceIdx].text);
            } else if (document.getElementById('scramble-bank').children.length === 0) {
                 feedback.textContent = "‚ùå Incorrect order. Try resetting.";
                 feedback.style.color = "#e74c3c";
            } else {
                feedback.textContent = "";
            }
        }

        function resetScramble() { loadScramble(currentSentenceIdx); }
        function nextScramble() {
            let next = (currentSentenceIdx + 1) % sentences.length;
            loadScramble(next);
        }

        /* --- 5. MATCHING LOGIC --- */
        function initMatch() {
            const leftCol = document.getElementById('match-left');
            const rightCol = document.getElementById('match-right');
            const lefts = matchPairs.map((p, i) => ({txt: p.q, id: i})).sort(() => Math.random() - 0.5);
            const rights = matchPairs.map((p, i) => ({txt: p.a, id: i})).sort(() => Math.random() - 0.5);

            leftCol.innerHTML = ''; rightCol.innerHTML = '';
            lefts.forEach(item => {
                const card = document.createElement('div');
                card.className = 'match-card';
                card.textContent = item.txt;
                card.dataset.id = item.id;
                card.onclick = () => selectLeft(card);
                leftCol.appendChild(card);
            });
            rights.forEach(item => {
                const card = document.createElement('div');
                card.className = 'match-card';
                card.textContent = item.txt;
                card.dataset.id = item.id;
                card.onclick = () => selectRight(card);
                rightCol.appendChild(card);
            });
        }

        function selectLeft(card) {
            if (card.classList.contains('matched')) return;
            document.querySelectorAll('#match-left .match-card').forEach(c => c.classList.remove('selected'));
            card.classList.add('selected');
            selectedLeft = card;
        }

        function selectRight(card) {
            if (!selectedLeft || card.classList.contains('matched')) return;
            const feedback = document.getElementById('match-feedback');
            if (selectedLeft.dataset.id === card.dataset.id) {
                selectedLeft.classList.add('matched');
                card.classList.add('matched');
                selectedLeft.classList.remove('selected');
                feedback.textContent = "It's a match!";
                feedback.style.color = "#2ecc71";
                selectedLeft = null;
            } else {
                feedback.textContent = "Not a match. Try again.";
                feedback.style.color = "#e74c3c";
            }
        }

        /* --- 6. SORTING LOGIC --- */
        function allowDrop(ev) { ev.preventDefault(); document.querySelectorAll('.sort-bucket').forEach(b => b.classList.add('drag-over')); }
        function drag(ev) { ev.dataTransfer.setData("text", ev.target.id); }
        function drop(ev, targetCat) {
            ev.preventDefault();
            document.querySelectorAll('.sort-bucket').forEach(b => b.classList.remove('drag-over'));
            const data = ev.dataTransfer.getData("text");
            const draggedElement = document.getElementById(data);
            const feedback = document.getElementById('sort-feedback');

            if (sortData[data] === targetCat) {
                ev.target.closest('.sort-bucket').appendChild(draggedElement);
                draggedElement.style.background = '#2ecc71';
                feedback.textContent = "Correct!";
                feedback.style.color = "#2ecc71";
            } else {
                feedback.textContent = "Try the other bucket.";
                feedback.style.color = "#e74c3c";
            }
        }

        /* --- 7. CHAT LOGIC --- */
        function handleChat(choiceIdx) {
            const data = chatSteps[chatStepIdx];
            const messages = document.getElementById('chat-messages');
            
            const userMsg = document.createElement('div');
            userMsg.className = 'msg sent';
            userMsg.textContent = data.opts[choiceIdx].txt;
            messages.appendChild(userMsg);

            if (data.opts[choiceIdx].correct) {
                chatStepIdx++;
                setTimeout(() => {
                    if (chatStepIdx < chatSteps.length) {
                        const reply = document.createElement('div');
                        reply.className = 'msg received';
                        reply.textContent = chatSteps[chatStepIdx].msg;
                        messages.appendChild(reply);
                        messages.scrollTop = messages.scrollHeight;
                        updateChatButtons();
                    } else {
                        const end = document.createElement('div');
                        end.className = 'msg received';
                        end.textContent = "Ali: That sounds like a great class! Let's go to the cafeteria.";
                        messages.appendChild(end);
                        document.getElementById('chat-options').innerHTML = '<div style="text-align:center; color:green; font-weight:bold;">Conversation Complete!</div>';
                    }
                }, 1000);
            } else {
                setTimeout(() => {
                    const error = document.createElement('div');
                    error.className = 'msg received';
                    error.style.background = '#ffdddd';
                    error.textContent = "Ali looks confused... (Check the story details!)";
                    messages.appendChild(error);
                    messages.scrollTop = messages.scrollHeight;
                    setTimeout(() => {
                        userMsg.remove();
                        error.remove();
                    }, 1500);
                }, 500);
            }
            messages.scrollTop = messages.scrollHeight;
        }

        function updateChatButtons() {
            const btns = document.querySelectorAll('.chat-btn');
            const data = chatSteps[chatStepIdx];
            btns[0].textContent = data.opts[0].txt;
            btns[1].textContent = data.opts[1].txt;
        }

        /* --- 8. DICTATION LOGIC --- */
        let currentDictationWord = "";
        function playDictationWord() {
            const randIndex = Math.floor(Math.random() * vocabList.length);
            currentDictationWord = vocabList[randIndex].word;
            speak(currentDictationWord);
        }

        function checkDictation() {
            const userText = document.getElementById('dictation-input').value.trim().toLowerCase();
            const feedback = document.getElementById('dictation-feedback');
            
            if (!currentDictationWord) {
                feedback.textContent = "Please click 'Play Word' first.";
                return;
            }

            if (userText === currentDictationWord.toLowerCase()) {
                feedback.textContent = "‚úÖ Correct! Excellent spelling.";
                feedback.style.color = "#2ecc71";
            } else {
                feedback.textContent = `‚ùå Incorrect. The word was: ${currentDictationWord}`;
                feedback.style.color = "#e74c3c";
            }
        }
    </script>
</body>
</html>
