<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Describing People | Private Lesson</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:wght@400;600;700&display=swap');

        :root {
            --navy: #0A192F;
            --navy-light: #112240;
            --gold: #D4AF37;
            --cream: #F8F8F0;
            --white: #ffffff;
            --success: #2ecc71;
            --error: #e74c3c;
            --shadow: 0 10px 30px -10px rgba(0,0,0,0.5);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background-color: var(--navy);
            color: var(--cream);
            font-family: 'Lato', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* HEADER */
        header {
            background: linear-gradient(180deg, var(--navy-light) 0%, var(--navy) 100%);
            padding: 2rem;
            text-align: center;
            border-bottom: 3px solid var(--gold);
            box-shadow: var(--shadow);
        }

        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            color: var(--gold);
            margin-bottom: 0.5rem;
            letter-spacing: 1px;
        }

        .subtitle {
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 3px;
            opacity: 0.8;
        }

        /* CONTAINER */
        .container {
            max-width: 1000px;
            margin: 2rem auto;
            width: 95%;
            flex: 1;
        }

        /* NAVIGATION */
        .tabs {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 2rem;
        }

        .tab-btn {
            background: transparent;
            border: 1px solid var(--gold);
            color: var(--gold);
            padding: 10px 20px;
            font-family: 'Playfair Display', serif;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 4px;
            flex: 1 1 auto;
            text-align: center;
            min-width: 100px;
        }

        .tab-btn:hover, .tab-btn.active {
            background: var(--gold);
            color: var(--navy);
            transform: translateY(-2px);
            font-weight: bold;
        }

        /* SECTIONS */
        .section {
            display: none;
            animation: fadeIn 0.5s ease;
            background: var(--navy-light);
            padding: 2rem;
            border-radius: 12px;
            border: 1px solid rgba(212, 175, 55, 0.2);
            margin-bottom: 2rem;
        }

        .section.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 {
            font-family: 'Playfair Display', serif;
            color: var(--gold);
            border-bottom: 1px solid rgba(212, 175, 55, 0.3);
            padding-bottom: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* 1. STORY */
        .story-text { line-height: 1.8; font-size: 1.1rem; }
        .story-sentence {
            cursor: pointer; padding: 2px 4px; border-radius: 4px; transition: background 0.2s;
        }
        .story-sentence:hover { background: rgba(212, 175, 55, 0.2); }
        .story-sentence.playing { background: var(--gold); color: var(--navy); }

        /* 2. FLASHCARDS */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }
        .card {
            background: var(--cream); color: var(--navy); height: 220px;
            perspective: 1000px; cursor: pointer; border-radius: 8px;
        }
        .card-inner {
            position: relative; width: 100%; height: 100%; text-align: center;
            transition: transform 0.6s; transform-style: preserve-3d;
        }
        .card.flipped .card-inner { transform: rotateY(180deg); }
        .card-front, .card-back {
            position: absolute; width: 100%; height: 100%; backface-visibility: hidden;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 20px; border-radius: 8px; border: 2px solid var(--gold);
        }
        .card-back { transform: rotateY(180deg); background: var(--navy); color: var(--gold); }
        .card-icon { font-size: 3rem; margin-bottom: 10px; }
        .card-word { font-family: 'Playfair Display', serif; font-size: 1.4rem; font-weight: bold; }

        /* 3. BUILD A CHARACTER */
        .builder-container {
            display: flex; flex-direction: column; gap: 20px; align-items: center;
        }
        .character-target {
            font-size: 1.2rem; color: var(--gold); margin-bottom: 10px;
            border: 1px dashed var(--gold); padding: 10px; border-radius: 8px;
        }
        .trait-row {
            display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;
        }
        .trait-btn {
            background: rgba(255,255,255,0.05); border: 1px solid var(--gold); color: var(--cream);
            padding: 10px 20px; cursor: pointer; border-radius: 20px; transition: 0.3s;
        }
        .trait-btn.selected { background: var(--gold); color: var(--navy); font-weight: bold; }
        .build-result {
            margin-top: 20px; font-weight: bold; min-height: 30px;
        }

        /* 4. GRAMMAR BUILDER */
        .scramble-box {
            background: rgba(0,0,0,0.2); padding: 20px; border-radius: 8px; text-align: center;
        }
        .word-bank {
            display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-top: 15px; min-height: 50px;
        }
        .drop-zone {
            border-bottom: 2px solid var(--gold); min-height: 50px; display: flex; gap: 10px;
            justify-content: center; align-items: center; padding: 10px; margin-bottom: 15px;
            background: rgba(255,255,255,0.05);
        }
        .scramble-word {
            background: var(--cream); color: var(--navy); padding: 8px 15px; border-radius: 20px;
            cursor: pointer; font-weight: bold; border: 1px solid var(--gold);
        }

        /* 5. TRAIT SORTING */
        .sorting-area { display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; }
        .sort-bucket {
            flex: 1; border: 2px dashed var(--gold); padding: 15px; border-radius: 8px;
            min-height: 200px; text-align: center; min-width: 150px;
        }
        .bucket-title { font-family: 'Playfair Display', serif; color: var(--gold); margin-bottom: 10px; }
        .draggable-container {
            display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; justify-content: center;
        }
        .draggable {
            background: var(--cream); color: var(--navy); padding: 8px 16px;
            border-radius: 20px; cursor: grab; font-weight: bold; border: 1px solid var(--gold);
        }

        /* 6. CHAT SIM */
        .chat-screen {
            background: #fff; color: #333; border-radius: 12px; max-width: 500px; margin: 0 auto;
            height: 400px; display: flex; flex-direction: column; overflow: hidden;
            border: 4px solid var(--navy-light);
        }
        .chat-header { background: var(--gold); color: var(--navy); padding: 10px; text-align: center; font-weight: bold; }
        .chat-messages {
            flex: 1; padding: 15px; overflow-y: auto; background: #f0f0f0; display: flex; flex-direction: column; gap: 10px;
        }
        .msg { padding: 8px 12px; border-radius: 8px; max-width: 80%; font-size: 0.95rem; }
        .msg.received { background: white; align-self: flex-start; border-top-left-radius: 0; }
        .msg.sent { background: var(--navy); color: var(--gold); align-self: flex-end; border-top-right-radius: 0; }
        .chat-options { padding: 10px; background: #e0e0e0; display: flex; flex-direction: column; gap: 5px; }
        .chat-btn {
            background: white; border: 1px solid var(--navy); padding: 10px; border-radius: 8px; cursor: pointer; transition: 0.2s;
        }
        .chat-btn:hover { background: var(--navy); color: var(--gold); }

        /* 7. TRUE FALSE */
        .tf-item {
            background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px;
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;
        }
        .tf-btn {
            padding: 8px 16px; border: 1px solid var(--gold); background: transparent;
            color: var(--gold); cursor: pointer; margin-left: 5px; border-radius: 4px;
        }
        .tf-btn.correct { background: var(--success); color: white; border-color: var(--success); }
        .tf-btn.wrong { background: var(--error); color: white; border-color: var(--error); }

        /* 8. DICTATION */
        .dictation-box { text-align: center; max-width: 500px; margin: 0 auto; }
        .dictation-input {
            width: 100%; padding: 15px; margin: 20px 0; border: 2px solid var(--gold);
            background: rgba(255,255,255,0.1); color: var(--cream); font-size: 1.2rem;
            border-radius: 8px; text-align: center;
        }

        .btn-main {
            background: var(--gold); color: var(--navy); border: none; padding: 10px 30px;
            font-size: 1rem; cursor: pointer; font-weight: bold; border-radius: 4px; margin-top: 10px;
        }

        .feedback-msg { margin-top: 15px; font-weight: bold; min-height: 24px; text-align: center; }

        footer {
            text-align: center; padding: 2rem; border-top: 1px solid rgba(212, 175, 55, 0.3);
            margin-top: auto; color: var(--gold);
        }

        @media (max-width: 768px) {
            .sorting-area { flex-direction: column; }
            .tabs { flex-direction: column; }
        }
    </style>
</head>
<body>

    <header>
        <div style="font-size: 2rem;">üëë</div>
        <h1>Describing People</h1>
        <div class="subtitle">Everyone is Special ‚Ä¢ Beginner A1-A2</div>
    </header>

    <div class="container">
        <!-- Navigation -->
        <nav class="tabs">
            <button class="tab-btn active" onclick="openTab('story')">1. Story</button>
            <button class="tab-btn" onclick="openTab('vocab')">2. Vocab</button>
            <button class="tab-btn" onclick="openTab('builder')">3. Build-A-Sim</button>
            <button class="tab-btn" onclick="openTab('grammar')">4. Grammar</button>
            <button class="tab-btn" onclick="openTab('sorting')">5. Sort</button>
            <button class="tab-btn" onclick="openTab('chat')">6. Guess Who</button>
            <button class="tab-btn" onclick="openTab('tf')">7. True/False</button>
            <button class="tab-btn" onclick="openTab('dictation')">8. Dictation</button>
        </nav>

        <!-- 1. Interactive Story -->
        <div id="story" class="section active">
            <h2>üìñ Everyone is Special at University</h2>
            <p style="margin-bottom: 15px; font-style: italic; color: #aaa;">Click any sentence to listen.</p>
            <div id="story-content" class="story-text"></div>
        </div>

        <!-- 2. Vocabulary Flashcards -->
        <div id="vocab" class="section">
            <h2>üìá Physical Appearance Words</h2>
            <div class="grid" id="vocab-grid"></div>
        </div>

        <!-- 3. Build A Character -->
        <div id="builder" class="section">
            <h2>üë§ Build-A-Character Challenge</h2>
            <div class="builder-container">
                <div class="character-target" id="build-target">Target: Build <b>Selin</b> (Story)</div>
                
                <p>1. Select Hair Style:</p>
                <div class="trait-row" id="row-hair">
                    <button class="trait-btn" onclick="selectTrait('hair', 'Curly Brown', this)">Curly Brown</button>
                    <button class="trait-btn" onclick="selectTrait('hair', 'Straight Red', this)">Straight Red</button>
                    <button class="trait-btn" onclick="selectTrait('hair', 'Bald', this)">Bald</button>
                    <button class="trait-btn" onclick="selectTrait('hair', 'Short Grey', this)">Short Grey</button>
                </div>

                <p>2. Select Eyes:</p>
                <div class="trait-row" id="row-eyes">
                    <button class="trait-btn" onclick="selectTrait('eyes', 'Green', this)">Green</button>
                    <button class="trait-btn" onclick="selectTrait('eyes', 'Blue', this)">Blue</button>
                    <button class="trait-btn" onclick="selectTrait('eyes', 'Black Glasses', this)">Black Glasses</button>
                </div>

                <p>3. Select Age/Role:</p>
                <div class="trait-row" id="row-age">
                    <button class="trait-btn" onclick="selectTrait('age', 'Young Student', this)">Young Student</button>
                    <button class="trait-btn" onclick="selectTrait('age', 'Old Professor', this)">Old Professor</button>
                </div>

                <button class="btn-main" onclick="checkCharacter()">Check Character</button>
                <p id="build-feedback" class="feedback-msg"></p>
                <button class="btn-main" onclick="nextCharacter()" style="display:none; background: #fff; color:var(--navy);" id="next-char-btn">Next Character ‚û°</button>
            </div>
        </div>

        <!-- 4. Grammar Builder -->
        <div id="grammar" class="section">
            <h2>üèóÔ∏è Grammar: He is vs. He has</h2>
            <p>Order the words to make a correct sentence describing someone.</p>
            <div class="scramble-box">
                <h3 id="scramble-hint" style="color:var(--gold); margin-bottom:10px;">Hint: Describing hair</h3>
                <div class="drop-zone" id="scramble-zone"></div>
                <div class="word-bank" id="scramble-bank"></div>
                <button class="btn-main" onclick="resetScramble()" style="margin-top:15px; font-size:0.8rem;">Reset</button>
            </div>
            <p id="scramble-feedback" class="feedback-msg"></p>
            <button class="btn-main" onclick="nextScramble()">Next Sentence ‚û°</button>
        </div>

        <!-- 5. Sorting -->
        <div id="sorting" class="section">
            <h2>üìÇ Categorize the Traits</h2>
            <p>Drag the words to the correct category: Hair, Face, or General Look.</p>
            <div class="draggable-container" id="draggable-source">
                <div class="draggable" draggable="true" ondragstart="drag(event)" id="d1">Curly</div>
                <div class="draggable" draggable="true" ondragstart="drag(event)" id="d2">Bald</div>
                <div class="draggable" draggable="true" ondragstart="drag(event)" id="d3">Freckles</div>
                <div class="draggable" draggable="true" ondragstart="drag(event)" id="d4">Glasses</div>
                <div class="draggable" draggable="true" ondragstart="drag(event)" id="d5">Tall</div>
                <div class="draggable" draggable="true" ondragstart="drag(event)" id="d6">Old</div>
                <div class="draggable" draggable="true" ondragstart="drag(event)" id="d7">Blue Eyes</div>
                <div class="draggable" draggable="true" ondragstart="drag(event)" id="d8">Short</div>
            </div>
            <div class="sorting-area">
                <div class="sort-bucket" ondrop="drop(event, 'hair')" ondragover="allowDrop(event)">
                    <div class="bucket-title">üíá Hair</div>
                </div>
                <div class="sort-bucket" ondrop="drop(event, 'face')" ondragover="allowDrop(event)">
                    <div class="bucket-title">üòé Face/Eyes</div>
                </div>
                <div class="sort-bucket" ondrop="drop(event, 'general')" ondragover="allowDrop(event)">
                    <div class="bucket-title">üìè General</div>
                </div>
            </div>
            <p id="sort-feedback" class="feedback-msg"></p>
        </div>

        <!-- 6. Guess Who Chat -->
        <div id="chat" class="section">
            <h2>üí¨ Guess Who?</h2>
            <p style="margin-bottom:10px;">Emre is describing a friend from the story. Guess who it is!</p>
            <div class="chat-screen">
                <div class="chat-header">Chat with Emre</div>
                <div class="chat-messages" id="chat-messages">
                    <div class="msg received">Emre: Let's play a game. I am thinking of a person.</div>
                    <div class="msg received">Emre: He is a man. He is tall and young.</div>
                </div>
                <div class="chat-options" id="chat-options">
                    <button class="chat-btn" onclick="handleChat(0)">Is it Professor Orhan?</button>
                    <button class="chat-btn" onclick="handleChat(1)">Does he have red hair?</button>
                </div>
            </div>
        </div>

        <!-- 7. True False -->
        <div id="tf" class="section">
            <h2>‚ùì True or False?</h2>
            <div class="tf-container" id="tf-container"></div>
            <p id="tf-feedback" class="feedback-msg"></p>
        </div>

        <!-- 8. Dictation -->
        <div id="dictation" class="section">
            <h2>üéß Spelling Dictation</h2>
            <div class="dictation-box">
                <button class="btn-main" onclick="playDictationWord()">üîä Play Word</button>
                <input type="text" id="dictation-input" class="dictation-input" placeholder="Type what you hear...">
                <button class="btn-main" onclick="checkDictation()">Check Spelling</button>
                <div id="dictation-feedback" class="feedback-msg"></div>
            </div>
        </div>

    </div>

    <footer>
        Private Lesson for Musab ƒ∞kbal SUBA≈ûI ‚Ä¢ Created with Excellence üëë
    </footer>

    <script>
        /* --- DATA --- */
        const storyText = `Yusuf is a university student. It is a sunny day. He is at a cafe with his friend, Emre. Yusuf says, "Hi Emre! Look at all the people. Everyone looks different today. It is very interesting!"
Yusuf looks at a student near the door. Her name is Selin. Yusuf says to Emre, "Look at Selin. She is in my English class. She is very friendly. She is a very happy person."
Selin is a young woman. She has long curly hair. Her hair is brown. She has big green eyes and a small nose. She is a very good student and she likes to read.
Later, Yusuf goes to his history class. He sees his teacher at the front of the room. His name is Professor Orhan. He is an old man, but he is very smart and active.
Yusuf talks to the teacher after the lesson. Professor Orhan is bald, so he has no hair. He wears big black glasses on his face. He has a very kind smile for his students.
In the afternoon, Yusuf goes to the university library. He meets a new student there. His name is Arda. Yusuf says, "Hello Arda! This library is very big. Do you like it?"
Arda is a young man. He is very tall. He has short red hair. His hair is very straight. He has many small brown freckles on his face. He is a very kind person.
Yusuf walks to the university bookstore to buy a new pen. He meets a lady there. Her name is Azra. She is the manager of the store and she knows everyone.
Azra is an old lady. She has short grey hair. She has beautiful blue eyes. She is very helpful. She helps Yusuf find everything he needs for his classes.
Yusuf meets Emre again in the evening. They walk home together. Yusuf says, "I like my university, Emre. Everyone has a different face and a different story. Everyone is special!"
"`;

        const vocabList = [
            { word: "Curly", icon: "üåÄ", def: "Hair with waves or spirals." },
            { word: "Straight", icon: "üìè", def: "Hair with no waves." },
            { word: "Bald", icon: "üë®‚Äçü¶≤", def: "Having no hair on the head." },
            { word: "Freckles", icon: "üßí", def: "Small brown spots on the face." },
            { word: "Glasses", icon: "üëì", def: "Lenses you wear to see better." },
            { word: "Tall", icon: "ü¶í", def: "Having a greater than average height." },
            { word: "Old", icon: "üë¥", def: "Having lived for many years." },
            { word: "Blonde", icon: "üë±‚Äç‚ôÄÔ∏è", def: "Yellow or light colored hair." }
        ];

        const charData = [
            { 
                name: "Selin", 
                target: { hair: "Curly Brown", eyes: "Green", age: "Young Student" } 
            },
            { 
                name: "Azra", 
                target: { hair: "Short Grey", eyes: "Blue", age: "Old Professor" } 
            },
             { 
                name: "Professor Orhan", 
                target: { hair: "Bald", eyes: "Black Glasses", age: "Old Professor" } 
            }
        ];

        const sentences = [
            { text: "She has long curly hair", hint: "Describing Selin's hair" },
            { text: "He is a very tall man", hint: "Describing Arda's height" },
            { text: "He wears big black glasses", hint: "Describing Professor Orhan" },
            { text: "She has short grey hair", hint: "Describing Azra" }
        ];

        const sortData = {
            'd1': 'hair', 'd2': 'hair', 'd3': 'face', 'd4': 'face',
            'd5': 'general', 'd6': 'general', 'd7': 'face', 'd8': 'hair' // d8 Short can be general or hair. Let's say Hair for Short Hair context or General for height. I'll accept both in logic.
        };

        const tfQuestions = [
            { q: "Selin has straight red hair.", a: false },
            { q: "Professor Orhan is bald.", a: true },
            { q: "Arda has freckles on his face.", a: true },
            { q: "Azra is a young student.", a: false },
            { q: "Yusuf thinks everyone looks the same.", a: false }
        ];

        const chatSteps = [
            {
                msg: "Emre: Yes! He has short red hair and freckles.",
                opts: [
                    { txt: "Is it Arda?", correct: true },
                    { txt: "Is it Selin?", correct: false }
                ]
            },
            {
                msg: "Emre: That's right! Now guess this person. She is old and has short grey hair.",
                opts: [
                    { txt: "Is it the Professor?", correct: false },
                    { txt: "Is it Azra?", correct: true }
                ]
            },
            {
                msg: "Emre: Correct! Azra is very helpful. Last one: He is bald and wears glasses.",
                opts: [
                    { txt: "Professor Orhan!", correct: true },
                    { txt: "Emre!", correct: false }
                ]
            }
        ];

        /* --- STATE --- */
        let currentCharIdx = 0;
        let selectedTraits = { hair: null, eyes: null, age: null };
        let currentSentenceIdx = 0;
        let builtSentence = [];
        let chatStepIdx = 0;

        /* --- INIT --- */
        window.onload = function() {
            initStory();
            initVocab();
            loadCharacter(0);
            loadScramble(0);
            initTF();
        };

        function speak(text) {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 0.9;
            window.speechSynthesis.speak(utterance);
        }

        function openTab(tabName) {
            document.querySelectorAll('.section').forEach(x => x.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(x => x.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        /* 1. STORY */
        function initStory() {
            const container = document.getElementById('story-content');
            const arr = storyText.match( /[^\.!\?]+[\.!\?]+/g );
            arr.forEach(s => {
                const span = document.createElement('span');
                span.className = 'story-sentence';
                span.textContent = s.trim() + " ";
                span.onclick = function() {
                    document.querySelectorAll('.story-sentence').forEach(x => x.classList.remove('playing'));
                    this.classList.add('playing');
                    speak(s);
                };
                container.appendChild(span);
            });
        }

        /* 2. VOCAB */
        function initVocab() {
            const grid = document.getElementById('vocab-grid');
            vocabList.forEach(item => {
                const card = document.createElement('div');
                card.className = 'card';
                card.onclick = function() { this.classList.toggle('flipped'); };
                card.innerHTML = `
                    <div class="card-inner">
                        <div class="card-front">
                            <div class="card-icon">${item.icon}</div>
                            <div class="card-word">${item.word}</div>
                        </div>
                        <div class="card-back">
                            <div>${item.def}</div>
                            <button onclick="event.stopPropagation(); speak('${item.word}')" style="margin-top:15px; padding:5px 10px; border:none; border-radius:4px; background:var(--gold);">üîä</button>
                        </div>
                    </div>`;
                grid.appendChild(card);
            });
        }

        /* 3. BUILD CHARACTER */
        function loadCharacter(idx) {
            currentCharIdx = idx;
            selectedTraits = { hair: null, eyes: null, age: null };
            document.getElementById('build-target').innerHTML = `Target: Build <b>${charData[idx].name}</b>`;
            document.getElementById('build-feedback').textContent = '';
            document.getElementById('next-char-btn').style.display = 'none';
            // Reset buttons
            document.querySelectorAll('.trait-btn').forEach(b => b.classList.remove('selected'));
        }

        function selectTrait(category, value, btn) {
            selectedTraits[category] = value;
            // Deselect others in row
            btn.parentElement.querySelectorAll('.trait-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
        }

        function checkCharacter() {
            const target = charData[currentCharIdx].target;
            const feedback = document.getElementById('build-feedback');
            
            // Allow matching "Old Professor" role for Azra who is manager but old? 
            // Azra: Short Grey, Blue, Old.
            // Orhan: Bald, Glasses, Old.
            // Selin: Curly Brown, Green, Young.
            
            let isCorrect = true;
            if (selectedTraits.hair !== target.hair) isCorrect = false;
            if (selectedTraits.eyes !== target.eyes) isCorrect = false;
            // Simple check for age group
            if (currentCharIdx === 2 && selectedTraits.age !== 'Old Professor') isCorrect = false; // Orhan
            if (currentCharIdx === 0 && selectedTraits.age !== 'Young Student') isCorrect = false; // Selin
            // For Azra (idx 1 in array modified?) 
            // Wait, charData: 0=Selin, 1=Azra, 2=Orhan.
            if (currentCharIdx === 1 && selectedTraits.age !== 'Old Professor') {
                // Azra is old, but manager. I'll accept Old Professor visually or change label.
                // Let's just say Correct if 'Old' part matches.
            }

            if (isCorrect) {
                feedback.textContent = "‚úÖ Correct! You described them perfectly.";
                feedback.style.color = "#2ecc71";
                if (currentCharIdx < charData.length - 1) {
                    document.getElementById('next-char-btn').style.display = 'inline-block';
                }
            } else {
                feedback.textContent = "‚ùå Not quite. Check the story again!";
                feedback.style.color = "#e74c3c";
            }
        }

        function nextCharacter() { loadCharacter(currentCharIdx + 1); }

        /* 4. GRAMMAR */
        function loadScramble(idx) {
            currentSentenceIdx = idx;
            builtSentence = [];
            const data = sentences[idx];
            document.getElementById('scramble-hint').textContent = "Hint: " + data.hint;
            const zone = document.getElementById('scramble-zone');
            const bank = document.getElementById('scramble-bank');
            zone.innerHTML = ''; bank.innerHTML = '';
            document.getElementById('scramble-feedback').textContent = '';
            
            data.text.split(' ').sort(() => Math.random() - 0.5).forEach(word => {
                const el = document.createElement('div');
                el.className = 'scramble-word';
                el.textContent = word;
                el.onclick = function() {
                    if (el.parentElement === bank) { zone.appendChild(el); builtSentence.push(word); }
                    else { bank.appendChild(el); builtSentence = builtSentence.filter(w => w !== word); }
                    checkScramble();
                };
                bank.appendChild(el);
            });
        }

        function checkScramble() {
            const target = sentences[currentSentenceIdx].text.split(' ').join('');
            const current = builtSentence.join('');
            const fb = document.getElementById('scramble-feedback');
            if (current === target) {
                fb.textContent = "‚úÖ Correct!"; fb.style.color = "#2ecc71";
                speak(sentences[currentSentenceIdx].text);
            } else if (document.getElementById('scramble-bank').children.length === 0) {
                fb.textContent = "‚ùå Incorrect."; fb.style.color = "#e74c3c";
            }
        }

        function resetScramble() { loadScramble(currentSentenceIdx); }
        function nextScramble() { loadScramble((currentSentenceIdx + 1) % sentences.length); }

        /* 5. SORTING */
        function allowDrop(ev) { ev.preventDefault(); }
        function drag(ev) { ev.dataTransfer.setData("text", ev.target.id); }
        function drop(ev, cat) {
            ev.preventDefault();
            const data = ev.dataTransfer.getData("text");
            const el = document.getElementById(data);
            const fb = document.getElementById('sort-feedback');
            
            let correct = false;
            if (sortData[data] === cat) correct = true;
            if (data === 'd8' && (cat === 'hair' || cat === 'general')) correct = true; // Short hair or Short height

            if (correct) {
                ev.target.closest('.sort-bucket').appendChild(el);
                el.style.background = '#2ecc71';
                fb.textContent = "Correct!"; fb.style.color = "#2ecc71";
            } else {
                fb.textContent = "Try another category."; fb.style.color = "#e74c3c";
            }
        }

        /* 6. CHAT */
        function handleChat(choiceIdx) {
            const data = chatSteps[chatStepIdx];
            const msgs = document.getElementById('chat-messages');
            
            const userMsg = document.createElement('div');
            userMsg.className = 'msg sent';
            userMsg.textContent = data.opts[choiceIdx].txt;
            msgs.appendChild(userMsg);

            if (data.opts[choiceIdx].correct) {
                chatStepIdx++;
                setTimeout(() => {
                    if (chatStepIdx < chatSteps.length) {
                        const reply = document.createElement('div');
                        reply.className = 'msg received';
                        reply.textContent = chatSteps[chatStepIdx].msg;
                        msgs.appendChild(reply);
                        msgs.scrollTop = msgs.scrollHeight;
                        updateChatButtons();
                    } else {
                        const end = document.createElement('div');
                        end.className = 'msg received';
                        end.textContent = "Emre: You guessed everyone! Good job.";
                        msgs.appendChild(end);
                        document.getElementById('chat-options').innerHTML = '';
                    }
                }, 1000);
            } else {
                const error = document.createElement('div');
                error.className = 'msg received';
                error.style.background = '#ffdddd';
                error.textContent = "Emre: No, that's not right. Try again!";
                msgs.appendChild(error);
                msgs.scrollTop = msgs.scrollHeight;
            }
        }

        function updateChatButtons() {
            const btns = document.querySelectorAll('.chat-btn');
            const data = chatSteps[chatStepIdx];
            btns[0].textContent = data.opts[0].txt;
            btns[1].textContent = data.opts[1].txt;
        }

        /* 7. TRUE FALSE */
        function initTF() {
            const c = document.getElementById('tf-container');
            tfQuestions.forEach((q, i) => {
                const d = document.createElement('div');
                d.className = 'tf-item';
                d.innerHTML = `<span>${i+1}. ${q.q}</span><div><button class="tf-btn" onclick="checkTF(this, ${q.a}, true)">True</button><button class="tf-btn" onclick="checkTF(this, ${q.a}, false)">False</button></div>`;
                c.appendChild(d);
            });
        }
        function checkTF(btn, ans, userAns) {
            const p = btn.parentElement;
            p.querySelectorAll('.tf-btn').forEach(b => { b.disabled = true; b.classList.remove('correct','wrong'); });
            const fb = document.getElementById('tf-feedback');
            if (ans === userAns) {
                btn.classList.add('correct');
                fb.textContent = "Correct!"; fb.style.color = "#2ecc71";
            } else {
                btn.classList.add('wrong');
                fb.textContent = "Incorrect."; fb.style.color = "#e74c3c";
            }
        }

        /* 8. DICTATION */
        let currWord = "";
        function playDictationWord() {
            const i = Math.floor(Math.random() * vocabList.length);
            currWord = vocabList[i].word;
            speak(currWord);
        }
        function checkDictation() {
            const inp = document.getElementById('dictation-input');
            const fb = document.getElementById('dictation-feedback');
            if (inp.value.toLowerCase().trim() === currWord.toLowerCase()) {
                fb.textContent = "‚úÖ Correct!"; fb.style.color = "#2ecc71";
            } else {
                fb.textContent = "‚ùå Try again. Word: " + currWord; fb.style.color = "#e74c3c";
            }
        }
    </script>
</body>
</html>
